---
title: Address misalign exception
published: true
---

想开始加exception了，之前cpu6 soc1里面只做过illegal instruction的，这次准备先搞address misalign的。

lsu里没处理这个，比如store，不管地址是不是misalign，都直接发出去给cache，发出data_req，只是要写的数据没有写进去。

![screenshot0](https://github.com/whensungoesdown/whensungoesdown.github.io/raw/main/_posts/2023-01-14-0.png)

st.h存两个字节，地址是0xc0000019，是不对其的。data_addr_ok是给回来了，后面data_data_ok是咋回事，这是个st指令。。

先记下，回头再调。


看了下龙芯手册，不是用的中断向量表，除了TLB，所有的exception和interrupt都是走CSR.EENTRY的入口。

然后通过CSR.ESTA里的信息由软件来判断是什么情况。

单这个EENTRY地址怎么定的，手册里没有。reset后的地址是1c000000是手册给出来的，这个EENTRY没给。

看了下chiplab，chiplab里没有exception这部分功能，之前也没注意。

查了下龙芯手册，结果发现LoongArch32和LoongArch64还不一样。


![screenshot1](https://github.com/whensungoesdown/whensungoesdown.github.io/raw/main/_posts/2023-01-14-1.png)

![screenshot2](https://github.com/whensungoesdown/whensungoesdown.github.io/raw/main/_posts/2023-01-14-2.png)

或者说LoongArch32是CSR.ECFG.VS为0时候的特殊情况。LoongArch64里可以用中断向量表的，为什么要这么设计，还不懂。

![screenshot3](https://github.com/whensungoesdown/whensungoesdown.github.io/raw/main/_posts/2023-01-14-3.png)
